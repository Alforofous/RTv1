/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   example.c                                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: dmalesev <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2022/07/20 22:07:14 by dmalesev          #+#    #+#             */
/*   Updated: 2022/07/25 08:27:09 by dmalesev         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "dm_bdf_render.h"

void	put_pixel(int x, int y, t_uint color, void *param)
{
	char	**screen;

	screen = (char **)param;
	if (x >= 0 && y >= 0 && x < 65 && y < 32)
	{
		if (color == 0xFF0000)
			ft_putstr("\e[31m");
		screen[y][x] = 'x';
		ft_putstr("\e[0m");
	}
}

static void	put_screen(char **screen)
{
	int	i;

	i = 0;
	while (i < 32)
	{
		ft_putendl(screen[i]);
		i++;
	}
}

static void	free_screen(char **screen, int lines)
{
	int	i;

	i = 0;
	while (i < lines)
	{
		free(screen[i]);
		i++;
	}
	free(screen);
	screen = NULL;
}

int	main(int argc, char **argv)
{
	char	**screen;
	t_font	*font;

	screen = ft_strsplit("\
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
", ' ');
	if (argc != 3)
	{
		ft_putstr("Usage: <filename.bdf> <character>\n");
		return (1);
	}
	if (screen == NULL)
	{
		ft_putstr("Mallocing failed in ft_strsplit...\n");
		return (1);
	}
	font = load_font(argv[1]);
	if (font == NULL)
	{
		free_screen(screen, 32);
		ft_putstr("Mallocing failed for struct...\n");
		return (1);
	}
	print_font_params(font);
	print_font_properties(&font->properties);
	render_str(argv[2], &(t_pxl){&put_pixel, screen}, &(t_2i){0, 0}, font);
	put_screen(screen);
	free_font(&font);
	free_screen(screen, 32);
	return (0);
}
