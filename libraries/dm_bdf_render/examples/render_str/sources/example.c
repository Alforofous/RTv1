/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   example.c                                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: dmalesev <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2022/07/20 22:07:14 by dmalesev          #+#    #+#             */
/*   Updated: 2022/10/16 10:21:51 by dmalesev         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "dm_bdf_render.h"

void	put_pixel(t_2i coords, t_uint color, void *param)
{
	char	**screen;

	screen = (char **)param;
	if (coords.x >= 0 && coords.y >= 0 && coords.x < 65 && coords.y < 32)
	{
		if (color == 0xFF0000)
			ft_putstr("\e[31m");
		screen[coords.y][coords.x] = 'x';
		ft_putstr("\e[0m");
	}
}

static void	put_screen(char **screen)
{
	int	i;

	i = 0;
	while (i < 32)
	{
		ft_putendl(screen[i]);
		i++;
	}
}

static void	free_screen(char **screen, int lines)
{
	int	i;

	i = 0;
	while (i < lines)
	{
		free(screen[i]);
		i++;
	}
	free(screen);
	screen = NULL;
}

static void	close_program(char *exit_msg, int exit_code)
{
	ft_putstr(exit_msg);
	exit (exit_code);
}

int	main(int argc, char **argv)
{
	char	**screen;
	t_font	*font;

	if (argc != 3)
		close_program("Usage: <filename.bdf> <string>.\n", -1);
	screen = ft_strsplit("\
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
................................................................. \
", ' ');
	if (screen == NULL)
		close_program("Mallocing failed in ft_strsplit...\n", -1);
	font = load_font(argv[1]);
	if (font == NULL)
	{
		free_screen(screen, 32);
		close_program("Mallocing failed for font struct...\n", -2);
	}
	print_font_params(font);
	print_font_properties(&font->properties);
	render_str(argv[2], &(t_pxl){font, &put_pixel, screen}, &(t_2i){0, 0}, 0x0);
	put_screen(screen);
	free_font(&font);
	free_screen(screen, 32);
	return (0);
}
